<!DOCTYPE html>
<html>
   <head>
     <meta charset="utf-8">
     <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
     <script src = "/socket.io/socket.io.js"></script>
     <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
     <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
     <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
     <title>Virtual Deck - Play Anywhere with Anyone</title>
      <style>
        #your_cards{
          font-size: 10em
        }
        .jumbotron-fluid{
          background-color: white;
        }
        #main{
          height: 80vh;
          padding: 20px 10%;
        }
        #mainrow{
          height: 80%;
          width: 100%;
        }
        .col-4{
          height: 100%;
        }
        #mainDeck{
          box-shadow: 1px 1px 5px 1px #888888;
          height: 100%;
          padding: 20px 20px;
        }
        #mainDeckText{
          font-size: 50px;
          width: 100%;
          text-align: center;
          margin-top: 20px;
          margin-bottom: 30px;
        }
        #main_card_deck{
          font-size: 20em;
          color:black;
          background-color: transparent;
        }
        #main_card_deck:focus{
          outline: none;
        }
        #DeckText{
          font-size: 35px;
          width: 100%;
          text-align: center;
        }
        .get_deck{
          font-size: 30px;
        }
      </style>
   </head>
   <script>
      var deck = [];
      var piles = [];
      var my_deck = [];
      var socket = io();
      socket.emit('connectRoom', '<%= data %>');

      socket.on('connectToRoom', function(data){
        $('#title').text(data);
      });

      socket.on('giveDeck', function(data){
        deck = data;
        $("#mainDeck").empty();
        var deck = "<button id = 'main_card_deck' class = 'btn center-block'>ðŸ‚ </button>";
        $("#mainDeck").append(deck);
        console.log(deck);
      })

      socket.on('getCards', function(data){
        my_deck = data;
        console.log(my_deck);
      })

      socket.on('movedCard', function(data){
        piles = data;
        console.log(piles);
      })

      socket.on('addedPile', function(data){
        piles = data;
        console.log(piles);
      })
   </script>
   <body>
     <div class = "jumbotron jumbotron-fluid">
     <div id = "main" class = "container-fluid">
       <div id = "mainrow" class = "row">
         <div class = "col-4">
           <div id = "mainDeck" class = "text-center">
             <p id = "mainDeckText">Everyone in?</p><br>
             <button class = "btn btn-outline-dark btn-lg btn-block get_deck" onclick = "getDeckJokers()">Get Deck</button>
             <p id = "DeckText"><small>or</small></p>
             <button class = "btn btn-outline-dark btn-lg btn-block get_deck" onclick = "getDeck()">Get Deck without Jokers</button>
           </div>
         </div>
         <div class = "col-8">
         </div>
       </div>
     </div>
    </div>
     <p id = "title"></p>
     <input id = "take_card" placeholder = "Take ? number of cards from main deck">
     <button id = "take_one">Take 1 Card</button>
     <button id = "shuffle_deck" onclick = "shuffleDeck()">Shuffle Deck</button>
     <button id = "add_pile" onclick = "addPile()">Add New
        Pile</button>
     <form id = "move_card">
       <input id = "move_cardindex" placeholder = "Move ?th card"> to
       <input id = "move_topile" placeholder = "Move card to ?th pile">
       <button type = "submit">Move</button>
     </form>
     <p draggable = "true" id = "your_cards">
       	ðŸ‚ 
     </p>
   </body>
   <script>

      function getDeckJokers() {
        socket.emit('getDeck', {'room' : '<%= data %>', 'jokers' : '1'});
      }
      function getDeck() {
        socket.emit('getDeck', {'room' : '<%= data %>', 'jokers' : '0'});
      }

      function shuffleDeck() {
        data = {"room" : "<%= data %>", "deck" : deck}
        socket.emit('shuffleDeck', data);
      }

      function addPile() {
        data = {"room" : "<%= data %>", "pile" : piles};
        socket.emit('addPile', data);
      }

      $("#move_card").submit(function() {
        data = {"room" : "<%= data %>", "card" : my_deck[$("#move_cardindex").val()], "pile" : piles, "pileIndex" : $("#move_topile").val()};
        my_deck.splice($("#move_cardindex").val(), 1);
        socket.emit('moveCard', data);
        $("#move_cardindex").val("");
        $("#move_topile").val("");
        return false;
      })

      $('#take_card').keypress(function(event) {
      var keycode = (event.keyCode ? event.keyCode : event.which);
      if (keycode == '13') {
        data = [{"room" : "<%= data %>", "numCards" : $('#take_card').val(), "deck" : deck, "mycards" : my_deck, "user" : socket.id}];
        socket.emit('takeCards', data);
      }
    });
   </script>
</html>
